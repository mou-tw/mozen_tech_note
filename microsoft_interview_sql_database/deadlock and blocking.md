
## 阻塞 (Blocking)
當一個交易（Transaction A）鎖住了某筆資源（例如某一列或資料頁），而另一個交易（Transaction B）想要存取同一筆資源但無法取得鎖，就會被 **阻塞（Blocked）**，只能等前一個交易完成。

- 是正常的鎖管理行為，暫時性的等待。
- 被阻塞的交易會「等待」持鎖者釋放鎖。
- 最終是可以繼續執行的（只要前一筆交易結束）。

## 死結 (Deadlock)
死結發生於兩個或多個交易彼此等待對方釋放資源，造成永遠無法繼續執行的循環等待。

- 是一種邏輯錯誤。
- SQL Server 會自動偵測死結，並選擇其中一個交易作為「犧牲者」來回滾（ROLLBACK）以解除死結。
- 不會自動恢復，會有一個交易失敗。

|項目|阻塞 (Blocking)|死結 (Deadlock)|
|---|---|---|
|行為類型|正常的鎖等待|非正常的資源循環等待|
|效果|被阻塞交易會暫時等待|系統會強制終止其中一個交易|
|整體影響|可能造成性能降低|導致交易失敗並需處理錯誤回復|
|解決方式|優化鎖持有時間、索引|避免交叉鎖順序、設定死結重試機制|


## try catch 如何解決dead lock

當 SQL Server 偵測到死結時，會選擇一個交易為「犧牲者」，並回滾（ROLLBACK）該交易，拋出錯誤（錯誤代碼 1205）

若你用 TRY...CATCH 捕捉這個錯誤，就可以讓系統「再試一次」執行這段交易邏輯。
這是最常見的解法之一